<div class="ui container">
  <h2 class="ui horizontal divider header">
    <i class="student icon"></i>
    <%= @course.title%>
  </h2>
</div>
<div class="ui horizontal segments">

  <div class="ui segment">
    <h3 class="ui top attached header inverted">
      Registered Students
    </h3>
  </div>
  <div class="ui segment">
<h3 class="ui top attached header inverted">
      Topics and Discussions
    </h3>
    <% if current_user.is_a.eql? "lecturer" %>



    <%= form_for(@topic, url: topics_path,:html => {:class => "ui reply form", :name => "topicTitle"}) do |f| %>

    <div class="field">
      <%= f.text_area :title %>

    </div>
    <div onclick="document.topicTitle.submit()" class="ui blue labeled submit icon button">
      <i class="icon edit"></i> Post Topic
    </div>
    
    <%= f.hidden_field :course_id, :value => @course.id %>
    <%= f.hidden_field :lecturer_id, :value => @current_user.lecturer.id %>
    
   
    <div class="ui accordion field">
      <div class="title ">
        <i class="icon dropdown"></i>
        Optional Details
      </div>
      <div class="content field ">
       <div class="ui toggle checkbox right floated">
    <%= f.check_box :is_final_exam,{:checked => false, :id => "isFinal"}, "true","false" %>
    <label>Final Exam</label>
    </div>
    <p></p>
        <label class="transition visible">Final Exam Duration</label>
        <div class="ui action input">
          <%= f.number_field :duration, placeholder: "Enter minute"%>
           <button class="ui teal button">Minute(s)</button>
</div>
      </div>
      
    </div>

    <% end %>
    <% end %>
    <div class="ui threaded comments">
        
        
        <% @all_topics_of_course.each do |topic|%>

         <div class="comment">
           
     <div class="ui right floated labeled button" tabindex="0">
      <% if @current_user.is_a.eql? "lecturer" %>
         
          <% if topic.topic_scores.any? %>
  <div class="ui teal button">
    <i class="checkmark icon"></i> Marked
  </div>
<%= link_to pluralize(topic.comments.count, 'comment'), topic_path(topic), class: "ui basic teal left pointing label reply" %>
  <% else %>

  <div class="ui red button">
    <i class="remove icon"></i> Not Marked 
  </div>
  <%= link_to pluralize(topic.comments.count, 'comment'), topic_path(topic), class: "ui basic red left pointing label reply" %>
  <% end %>

  
  

<% elsif @current_user.is_a.eql? "student"%>
<% if topic.topic_scores.any? %>
<div class="ui labeled button" tabindex="0">
  <div class="ui teal button">
    <i class="heart icon"></i> Mark
  </div>
  <a class="ui basic teal left pointing label">
    <%= topic.topic_scores.where(student_id: @current_user.student.id).first.score %>
  </a>
</div>

<% else %>
<div class="ui labeled button" tabindex="0">
  <div class="ui red button">
    <i class="heart icon"></i> Mark
  </div>
  <a class="ui basic red left pointing label">
    Not Marked
  </a>
</div>
  <% end %>
  <%end %>

      
      </div>
          <a class="avatar">
            <%= image_tag 'defaultuser.png' %>
          </a>
          <div class="content">
            <a class="author"><%= topic.lecturer.user.generalinfo.first_name + " " + topic.lecturer.user.generalinfo.last_name%></a>
            <div class="metadata">
              <span class="date">Posted <%= time_ago_in_words(topic.created_at) %> ago.</span>
            </div>
            <div class="text">
              <%=topic.title%>
            </div>
            

           


            </div>
             <div class="comments">
       <% if topic.comments.any? %>

          
              <% topic.comments.each do |comment| %>
              <div class="comment">

                <a class="avatar">
                  <%= image_tag 'defaultuser.png' %>
                </a>
                <div class="content">
                  <a class="author"><%= comment.student.user.generalinfo.first_name + " " + comment.student.user.generalinfo.last_name%></a>
                  <div class="metadata">
                    <span class="date">Posted <%= time_ago_in_words(comment.created_at) %> ago.</span>
                  </div>
                  <div class="text">
                    <%= comment.content %>
                  </div>

                </div>
              </div>
              <% end %>
                
                <% end %>
      <% if current_user.is_a.eql? "student" and (Time.zone.now < (topic.created_at + 7.day)) %>
            <%= form_for(@comment, url: comments_path,:html => {:class => "ui reply form", :name => "topicComment"}) do |fc| %>

            <div class="field">
              <%= fc.text_area :content %>

            </div>
           
           
            <%= fc.submit "Add Comment", class: "ui blue submit icon button" %>

            <%= fc.hidden_field :student_id, :value => @current_user.student.id %>
            <%= fc.hidden_field :topic_id, :value => topic.id %>

            <% end %>
            <% end %>
    </div>

            </div>

            <% end %>
            </div>
  </div>
  
      <div class="ui segment ">
        <h3 class="ui top attached header inverted">
          Registered Students
        </h3>
        <div class="ui celled list">
          <% @students_of_course.each do |student| %>
          <div class="item">
            <%= image_tag 'defaultuser.png', class: 'ui avatar image' %>
            <div class="content">
              <div class="header"><%= student.user.generalinfo.first_name%></div>
              Student
            </div>
          </div>
          <%end%>
        </div>
      </div>
      
    
    

  </div>

<script type="text/javascript">
$(document).ready(function(){
        $('#isFinal').click(function(){
            if($(this).is(":not(:checked)")){
                $('#topic_duration').val(0);
            }
                   });
    });
$('.ui.accordion.field')
  .accordion()
;

</script>


